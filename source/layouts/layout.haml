!!!
%html(lang="en")
  %head
    %meta(charset="utf-8")
    
    // Always force latest IE rendering engine or request Chrome Frame
    %meta(content="IE=edge,chrome=1" http-equiv="X-UA-Compatible")

    %meta(name="viewport" content="width=device-width, initial-scale=1.0")
    
    // Use title if it's in the page YAML frontmatter
    %title
      = current_page.data.title || "DHData"

    = favicon_tag 'images/dhdata-navbar-logo.png'

    = stylesheet_link_tag "all"
    /stylesheet_link_tag "code"
  
  %body{:class => page_classes}
    %a.sr-only(href="#main-content") Skip to main content

    .navbar.navbar-default.navbar-fixed-top(role="navigation")
      .container
        .navbar-header
          %button.navbar-toggle(type="button" data-toggle="collapse" data-target=".navbar-collapse")
            %span.sr-only Toggle navigation
            %span.icon-bar
            %span.icon-bar
            %span.icon-bar
          %a.navbar-brand(href="/")
            = image_tag 'dhdata-navbar-logo.png'
        .collapse.navbar-collapse
          %ul.nav.navbar-nav
            - data.navigation.links.each do |info|
              - liclasses = []
              - aclasses = []
              - liclasses.push "active" if current_url?(info['link'])
              - if info['links']
                - aclasses.push "dropdown-toggle"
                - atoggle = 'dropdown'
                - liclasses.push "dropdown"
                - info['links'].each do |subinfo|
                  - liclasses |= [ 'active' ] if current_url?(subinfo['link'])

              %li{:class => liclasses.join(' ')}
                - if info['link']
                  %a{:href => info['link'], 'data-toggle' => atoggle, :class => aclasses.join(' ')}
                    = info['name']
                    - if info['links']
                      %b.caret
                - else
                  - if liclasses.include?('dropdown')
                    %a{:href => '#', 'data-toggle' => atoggle, :class => aclasses.join(' ')}
                      = info['name']
                      %b.caret
                  - else
                    = info['name']

                - if liclasses.include?('dropdown')
                  %ul.dropdown-menu
                    - info['links'].each do |subinfo|
                      %li
                        %a{:href => subinfo['link']}= subinfo['name']
              
    - if content_for?(:jumbotron)
      = yield_content :jumbotron

    .container
      .col-md-12
        - if current_page.parent
          %ol.breadcrumb.hidden-xs
            = partial "/layouts/breadcrumb", :locals => { :page => current_page.parent, :as_select => false }
            %li.active= current_page.data.title
          %select#breadcrumb-select.visible-xs
            = partial "/layouts/breadcrumb", :locals => { :page => current_page.parent, :as_select => true }
            %option(value="#" selected="selected")= current_page.data.title
          - content_for :scripts do
            :coffeescript
              jQuery ->
                jQuery("#breadcrumb-select").bind 'change', (e) ->
                  e.preventDefault()
                  window.location.href = jQuery("#breadcrumb-select").val()

        - if current_page.data.title
          %h1= current_page.data.title
        = yield
    %footer
      .container
        .col-xs-12.col-sm-4
          %ul.list-unstyled
            %li
              = link_to 'About DH Data', '/about'
            %li
              %a(href="http://lists.dhdata.org/") Mailing Lists
            %li
              = link_to 'Policies', '/policies'
        .col-xs-12.col-sm-4
          %ul.list-unstyled
            %li
              %a(href="http://docs.ckan.org/en/ckan-2.0/api.html") CKAN API
            %li
              %a(href="http://www.opendefinition.org/okd/") Open Data
            %li
              %a(href="http://www.okfn.org/") Open Knowledge Foundation
        .col-xs-12.col-sm-4
          %ul.list-unstyled
            %li
              Powered by
              %a(href="http://ckan.org") CKAN
              and
              %a(href="http://middlemanapp.com/") Middleman
            %li
              Hosted by
              %a(href="http://www.umd.edu/") UMD
              %a(href="http://mith.umd.edu/") MITH
            %li
              Released under the
              %a(href="http://creativecommons.org/licenses/by/3.0/") CC-BY
              license
    = javascript_include_tag  "all"
    = javascript_include_tag "//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"
    - if content_for?(:scripts)
      = yield_content :scripts
    :javascript
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-41821116-1', 'dhdata.org');
      ga('send', 'pageview');
